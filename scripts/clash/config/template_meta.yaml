mixed-port: 7890
allow-lan: true
external-controller: 0.0.0.0:9090
mode: Rule
log-level: info
ipv6: true
tcp-concurrent: true
unified-delay: true
dns:
  enable: true
  ipv6: true
  prefer-h3: false
  default-nameserver:
    - 119.29.29.29                       # Tencent DNS (DNSPod)
    - 223.5.5.5                          # AliDNS
    - 1.1.1.1
    - 8.8.8.8
  nameserver:
    - https://doh.pub/dns-query          # Tencent DoH
    - https://dns.alidns.com/dns-query   # AliDNS DoH
    - https://1.1.1.1/dns-query
    - https://8.8.8.8/dns-query
    - 119.29.29.29                       # Tencent DNS (DNSPod)
    - 223.5.5.5                          # AliDNS
    - 1.1.1.1
    - 8.8.8.8
  nameserver-policy:
    geosite:cn:
      - https://doh.pub/dns-query
      - https://dns.alidns.com/dns-query
      - https://1.12.12.12/dns-query
      - https://223.5.5.5/dns-query
  proxy-server-nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
    - https://1.12.12.12/dns-query
    - https://223.5.5.5/dns-query
sniffer:
  enable: true
  parse-pure-ip: true
  override-destination: true
  sniffing:
    - tls
    - http
  force-domain:
    - "+.openai.com"
    - "+.chatgpt.com"
    - "+.anthropic.com"
    - "+.claude.ai"
    - "+.x.ai"
    - "+.grok.x.ai"
    - "+.perplexity.ai"
    - "+.pplx.ai"
    - "+.cohere.ai"
    - "+.cohere.com"
    - "+.mistral.ai"
    - "+.together.ai"
    - "+.together.xyz"
    - "+.openrouter.ai"
    - "+.huggingface.co"
    - "+.stability.ai"
    - "+.replicate.com"
  skip-domain:
    - "msftconnecttest.com"
    - "msftncsi.com"
proxies:
proxy-groups:
  # 基础选择器
  - name: Switch
    type: select
    proxies:
      - <all>
  - name: Intelligent
    type: select
    proxies:
      - Switch
      - <all>
      - <countries>
      - DIRECT
  - name: Google
    type: select
    proxies:
      - Switch
      - <all>
      - <countries>
      - DIRECT
  - name: Microsoft
    type: select
    proxies:
      - Switch
      - <all>
      - <countries>
      - DIRECT
  - name: Apple
    type: select
    proxies:
      - Switch
      - <all>
      - <countries>
      - DIRECT
  # 媒体/社交合并
  - name: Media
    type: select
    proxies:
      - Switch
      - <all>
      - <countries>
      - DIRECT
  - name: AdGuard
    type: select
    proxies:
      - REJECT
      - DIRECT
  - name: Catch
    type: select
    proxies:
      - Switch
      - <all>
      - <countries>
      - DIRECT
rule-providers:
  Advertising:
    type: http
    behavior: classical
    path: ./ruleset/Advertising.yaml
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Advertising/Advertising.yaml
    interval: 86400
  Google:
    type: http
    behavior: classical
    path: ./ruleset/Google.yaml
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Google/Google.yaml
    interval: 86400
  Microsoft:
    type: http
    behavior: classical
    path: ./ruleset/Microsoft.yaml
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Microsoft/Microsoft.yaml
    interval: 86400
  OneDrive:
    type: http
    behavior: classical
    path: ./ruleset/OneDrive.yaml
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/OneDrive/OneDrive.yaml
    interval: 86400
  Apple:
    type: http
    behavior: classical
    path: ./ruleset/Apple.yaml
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Apple/Apple.yaml
    interval: 86400
  GitHub:
    type: http
    behavior: classical
    path: ./ruleset/GitHub.yaml
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GitHub/GitHub.yaml
    interval: 86400
  YouTube:
    type: http
    behavior: classical
    path: ./ruleset/YouTube.yaml
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/YouTube/YouTube.yaml
    interval: 86400
  Telegram:
    type: http
    behavior: classical
    path: ./ruleset/Telegram.yaml
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Telegram/Telegram.yaml
    interval: 86400
  Twitter:
    type: http
    behavior: classical
    path: ./ruleset/Twitter.yaml
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Twitter/Twitter.yaml
    interval: 86400
  LAN:
    type: http
    behavior: classical
    path: ./ruleset/LAN.yaml
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/LAN/LAN.yaml
    interval: 86400
  ChinaMax:
    type: http
    behavior: classical
    path: ./ruleset/ChinaMax.yaml
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/ChinaMax/ChinaMax.yaml
    interval: 86400
rules:
  # 局域网与常见私有网段直连
  - RULE-SET,LAN,DIRECT
  # 广告拦截（与 AdGuard 分组对齐）
  - RULE-SET,Advertising,AdGuard
  # AI（优先生效，保持手动维护域名）
  - DOMAIN-SUFFIX,openai.com,Intelligent
  - DOMAIN-SUFFIX,chatgpt.com,Intelligent
  - DOMAIN-KEYWORD,openai,Intelligent
  - DOMAIN-SUFFIX,gemini.google.com,Intelligent
  - DOMAIN-SUFFIX,aistudio.google.com,Intelligent
  - DOMAIN-SUFFIX,ai.google.dev,Intelligent
  - DOMAIN-SUFFIX,generativelanguage.googleapis.com,Intelligent
  - DOMAIN-SUFFIX,makersuite.google.com,Intelligent
  - DOMAIN-SUFFIX,x.ai,Intelligent
  - DOMAIN-SUFFIX,grok.x.ai,Intelligent
  - DOMAIN-KEYWORD,grok,Intelligent
  - DOMAIN-SUFFIX,anthropic.com,Intelligent
  - DOMAIN-SUFFIX,api.anthropic.com,Intelligent
  - DOMAIN-SUFFIX,claude.ai,Intelligent
  - DOMAIN-KEYWORD,claude,Intelligent
  - DOMAIN-SUFFIX,perplexity.ai,Intelligent
  - DOMAIN-SUFFIX,api.perplexity.ai,Intelligent
  - DOMAIN-SUFFIX,pplx.ai,Intelligent
  - DOMAIN-SUFFIX,cohere.com,Intelligent
  - DOMAIN-SUFFIX,cohere.ai,Intelligent
  - DOMAIN-SUFFIX,api.cohere.ai,Intelligent
  - DOMAIN-SUFFIX,mistral.ai,Intelligent
  - DOMAIN-SUFFIX,api.mistral.ai,Intelligent
  - DOMAIN-SUFFIX,together.ai,Intelligent
  - DOMAIN-SUFFIX,together.xyz,Intelligent
  - DOMAIN-SUFFIX,api.together.xyz,Intelligent
  - DOMAIN-SUFFIX,openrouter.ai,Intelligent
  - DOMAIN-SUFFIX,api.openrouter.ai,Intelligent
  - DOMAIN-SUFFIX,huggingface.co,Intelligent
  - DOMAIN-SUFFIX,api-inference.huggingface.co,Intelligent
  - DOMAIN-SUFFIX,stability.ai,Intelligent
  - DOMAIN-SUFFIX,api.stability.ai,Intelligent
  - DOMAIN-SUFFIX,replicate.com,Intelligent
  - DOMAIN-SUFFIX,replicate.ai,Intelligent
  - DOMAIN-SUFFIX,api.replicate.com,Intelligent
  - DOMAIN-SUFFIX,copilot.microsoft.com,Intelligent
  # 始终直连
  - DOMAIN-KEYWORD,bilibili,DIRECT
  # 平台分流（使用 rule-providers）
  - RULE-SET,GitHub,Microsoft
  - RULE-SET,Google,Google
  - RULE-SET,Microsoft,Microsoft
  - RULE-SET,OneDrive,Microsoft
  - RULE-SET,Apple,Apple
  - RULE-SET,YouTube,Media
  - RULE-SET,Telegram,Media
  - RULE-SET,Twitter,Media
  # 中国大陆直连（域名与 IP）
  - RULE-SET,ChinaMax,DIRECT
  - GEOIP,CN,DIRECT
  # 兜底（漏网之鱼）
  - MATCH,Catch
